{"version":3,"file":"server.js","sourceRoot":"","sources":["../../../../../src/cli/services/dev/extension/server.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,cAAc,EACd,0BAA0B,EAC1B,yBAAyB,EACzB,2BAA2B,EAC3B,6BAA6B,EAC7B,2BAA2B,EAC3B,8BAA8B,EAC9B,gBAAgB,EAChB,iBAAiB,EACjB,8BAA8B,GAC/B,MAAM,yBAAyB,CAAA;AAGhC,OAAO,EAAC,SAAS,EAAE,YAAY,EAAC,MAAM,IAAI,CAAA;AAC1C,OAAO,EAAC,YAAY,EAAC,MAAM,MAAM,CAAA;AAOjC,MAAM,UAAU,eAAe,CAAC,OAA+B;IAC7D,MAAM,OAAO,GAAG,SAAS,EAAE,CAAA;IAC3B,MAAM,UAAU,GAAG,YAAY,EAAE,CAAA;IAEjC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAA;IACtC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAA;IAC3B,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAA;IAC9B,UAAU,CAAC,GAAG,CAAC,yBAAyB,EAAE,yBAAyB,CAAC,CAAA;IACpE,UAAU,CAAC,GAAG,CAAC,6CAA6C,EAAE,0BAA0B,CAAC,CAAA;IACzF,UAAU,CAAC,GAAG,CAAC,0BAA0B,EAAE,6BAA6B,CAAC,OAAO,CAAC,CAAC,CAAA;IAClF,UAAU,CAAC,GAAG,CAAC,2BAA2B,EAAE,6BAA6B,CAAC,OAAO,CAAC,CAAC,CAAA;IACnF,UAAU,CAAC,GAAG,CAAC,gDAAgD,EAAE,2BAA2B,CAAC,OAAO,CAAC,CAAC,CAAA;IACtG,UAAU,CAAC,GAAG,CAAC,8CAA8C,EAAE,2BAA2B,CAAC,OAAO,CAAC,CAAC,CAAA;IACpG,UAAU,CAAC,GAAG,CAAC,aAAa,EAAE,8BAA8B,CAAC,OAAO,CAAC,CAAC,CAAA;IACtE,UAAU,CAAC,GAAG,CAAC,cAAc,EAAE,8BAA8B,CAAC,OAAO,CAAC,CAAC,CAAA;IACvE,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE,8BAA8B,CAAC,CAAA;IAEnD,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,CAAA;IAEvB,kEAAkE;IAClE,MAAM,UAAU,GAAG,YAAY,CAAC,OAAO,CAAC,CAAA;IACxC,UAAU,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAA;IAC1C,OAAO,UAAU,CAAA;AACnB,CAAC","sourcesContent":["import {\n  corsMiddleware,\n  devConsoleAssetsMiddleware,\n  devConsoleIndexMiddleware,\n  getExtensionAssetMiddleware,\n  getExtensionPayloadMiddleware,\n  getExtensionPointMiddleware,\n  getExtensionsPayloadMiddleware,\n  getLogMiddleware,\n  noCacheMiddleware,\n  redirectToDevConsoleMiddleware,\n} from './server/middlewares.js'\nimport {ExtensionsPayloadStore} from './payload/store.js'\nimport {ExtensionDevOptions} from '../extension.js'\nimport {createApp, createRouter} from 'h3'\nimport {createServer} from 'http'\n\ninterface SetupHTTPServerOptions {\n  devOptions: ExtensionDevOptions\n  payloadStore: ExtensionsPayloadStore\n}\n\nexport function setupHTTPServer(options: SetupHTTPServerOptions) {\n  const httpApp = createApp()\n  const httpRouter = createRouter()\n\n  httpApp.use(getLogMiddleware(options))\n  httpApp.use(corsMiddleware)\n  httpApp.use(noCacheMiddleware)\n  httpRouter.use('/extensions/dev-console', devConsoleIndexMiddleware)\n  httpRouter.use('/extensions/dev-console/assets/**:assetPath', devConsoleAssetsMiddleware)\n  httpRouter.use('/extensions/:extensionId', getExtensionPayloadMiddleware(options))\n  httpRouter.use('/extensions/:extensionId/', getExtensionPayloadMiddleware(options))\n  httpRouter.use('/extensions/:extensionId/:extensionPointTarget', getExtensionPointMiddleware(options))\n  httpRouter.use('/extensions/:extensionId/assets/**:assetPath', getExtensionAssetMiddleware(options))\n  httpRouter.use('/extensions', getExtensionsPayloadMiddleware(options))\n  httpRouter.use('/extensions/', getExtensionsPayloadMiddleware(options))\n  httpRouter.use('/', redirectToDevConsoleMiddleware)\n\n  httpApp.use(httpRouter)\n\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  const httpServer = createServer(httpApp)\n  httpServer.listen(options.devOptions.port)\n  return httpServer\n}\n"]}