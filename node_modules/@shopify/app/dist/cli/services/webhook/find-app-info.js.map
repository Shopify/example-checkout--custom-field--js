{"version":3,"file":"find-app-info.js","sourceRoot":"","sources":["../../../../src/cli/services/webhook/find-app-info.ts"],"names":[],"mappings":"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","sourcesContent":["import {selectOrganizationPrompt, selectAppPrompt} from '../../prompts/dev.js'\nimport {fetchAppFromApiKey, fetchOrganizations, fetchOrgAndApps} from '../dev/fetch.js'\nimport {readAndParseDotEnv} from '@shopify/cli-kit/node/dot-env'\nimport {fileExists} from '@shopify/cli-kit/node/fs'\nimport {joinPath, basename, cwd} from '@shopify/cli-kit/node/path'\n\nexport interface AppCredentials {\n  clientSecret?: string\n  apiKey?: string\n  clientId?: string\n}\n\n/**\n * Grabs secret and api_key from .env file if existing\n *\n * @returns secret and api_key\n */\nexport async function findInEnv(): Promise<AppCredentials> {\n  const credentials: AppCredentials = {}\n\n  const envFile = joinPath(cwd(), '.env')\n  if (await fileExists(envFile)) {\n    const dotenv = await readAndParseDotEnv(envFile)\n\n    credentials.clientSecret = dotenv.variables.SHOPIFY_API_SECRET\n    credentials.apiKey = dotenv.variables.SHOPIFY_API_KEY\n  }\n\n  return credentials\n}\n\n/**\n * Find the app api_key, if available\n *\n * @param token - partners token\n * @returns apiKey\n */\nexport async function findApiKey(token: string): Promise<string | undefined> {\n  const orgs = await fetchOrganizations(token)\n  const org = await selectOrganizationPrompt(orgs)\n  const {apps} = await fetchOrgAndApps(org.id, token)\n\n  if (apps.nodes.length === 0) {\n    return\n  }\n\n  // Try to infer from current folder\n  const currentDir = basename(cwd())\n  const appFromDir = apps.nodes.find((elm) => elm.title === currentDir)\n  let apiKey\n  if (appFromDir === undefined) {\n    if (apps.nodes.length === 1 && apps.nodes[0]?.apiKey) {\n      apiKey = apps.nodes[0].apiKey\n    } else {\n      apiKey = await selectAppPrompt(apps, org.id, token)\n    }\n  } else {\n    apiKey = appFromDir.apiKey\n  }\n\n  return apiKey\n}\n\n/**\n * Find the app api_key, if available\n *\n * @param token - partners token\n * @param apiKey - app api_key\n * @returns client_id, client_secret, client_api_key\n */\nexport async function requestAppInfo(token: string, apiKey: string): Promise<AppCredentials> {\n  const fullSelectedApp = await fetchAppFromApiKey(apiKey, token)\n  const credentials: AppCredentials = {}\n  if (fullSelectedApp === undefined) {\n    return credentials\n  }\n  credentials.apiKey = apiKey\n  credentials.clientId = fullSelectedApp.id\n\n  const entry = fullSelectedApp.apiSecretKeys.find((elm) => elm.secret)\n  if (entry) {\n    credentials.clientSecret = entry.secret\n  }\n\n  return credentials\n}\n"]}