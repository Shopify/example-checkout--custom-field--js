{"version":3,"file":"loader.js","sourceRoot":"","sources":["../../../../src/cli/models/app/loader.ts"],"names":[],"mappings":"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","sourcesContent":["import {UIExtension, ThemeExtension, FunctionExtension, Extension, GenericSpecification} from './extensions.js'\nimport {AppConfigurationSchema, Web, WebConfigurationSchema, App, AppInterface, WebType} from './app.js'\nimport {configurationFileNames, dotEnvFileNames} from '../../constants.js'\nimport metadata from '../../metadata.js'\nimport {UIExtensionInstance, UIExtensionSpec} from '../extensions/ui.js'\nimport {ThemeExtensionInstance, ThemeExtensionSpec} from '../extensions/theme.js'\nimport {BaseFunctionConfigurationSchema, ThemeExtensionSchema, TypeSchema} from '../extensions/schemas.js'\nimport {FunctionInstance} from '../extensions/functions.js'\nimport {zod} from '@shopify/cli-kit/node/schema'\nimport {fileExists, readFile, glob, findPathUp} from '@shopify/cli-kit/node/fs'\nimport {readAndParseDotEnv, DotEnvFile} from '@shopify/cli-kit/node/dot-env'\nimport {\n  getDependencies,\n  getPackageManager,\n  getPackageName,\n  usesWorkspaces as appUsesWorkspaces,\n} from '@shopify/cli-kit/node/node-package-manager'\nimport {resolveFramework} from '@shopify/cli-kit/node/framework'\nimport {getArrayRejectingUndefined} from '@shopify/cli-kit/common/array'\nimport {camelize} from '@shopify/cli-kit/common/string'\nimport {hashString} from '@shopify/cli-kit/node/crypto'\nimport {decodeToml} from '@shopify/cli-kit/node/toml'\nimport {isShopify} from '@shopify/cli-kit/node/context/local'\nimport {joinPath, dirname, basename} from '@shopify/cli-kit/node/path'\nimport {AbortError} from '@shopify/cli-kit/node/error'\nimport {outputContent, outputDebug, OutputMessage, outputToken} from '@shopify/cli-kit/node/output'\n\nconst defaultExtensionDirectory = 'extensions/*'\n\nexport type AppLoaderMode = 'strict' | 'report'\n\nexport class AppErrors {\n  private errors: {\n    [key: string]: OutputMessage\n  } = {}\n\n  addError(path: string, message: OutputMessage): void {\n    this.errors[path] = message\n  }\n\n  getError(path: string) {\n    return this.errors[path]\n  }\n\n  isEmpty() {\n    return Object.keys(this.errors).length === 0\n  }\n\n  toJSON(): OutputMessage[] {\n    return Object.values(this.errors)\n  }\n}\n\ninterface AppLoaderConstructorArgs {\n  directory: string\n  mode?: AppLoaderMode\n  specifications: GenericSpecification[]\n}\n\n/**\n * Load the local app from the given directory and using the provided extensions/functions specifications.\n * If the App contains extensions not supported by the current specs and mode is strict, it will throw an error.\n */\nexport async function load(options: AppLoaderConstructorArgs): Promise<AppInterface> {\n  const loader = new AppLoader(options)\n  return loader.loaded()\n}\n\nclass AppLoader {\n  private directory: string\n  private mode: AppLoaderMode\n  private appDirectory = ''\n  private configurationPath = ''\n  private errors: AppErrors = new AppErrors()\n  private specifications: GenericSpecification[]\n\n  constructor({directory, mode, specifications}: AppLoaderConstructorArgs) {\n    this.mode = mode ?? 'strict'\n    this.directory = directory\n    this.specifications = specifications\n  }\n\n  findSpecificationForType(type: string) {\n    return this.specifications.find((spec) => spec.identifier === type || spec.externalIdentifier === type)\n  }\n\n  async loaded() {\n    this.appDirectory = await this.findAppDirectory()\n    const configurationPath = await this.getConfigurationPath()\n    const configuration = await this.parseConfigurationFile(AppConfigurationSchema, configurationPath)\n    const dotenv = await this.loadDotEnv()\n    const {functions, usedCustomLayout: usedCustomLayoutForFunctionExtensions} = await this.loadFunctions(\n      configuration.extensionDirectories,\n    )\n    const {uiExtensions, usedCustomLayout: usedCustomLayoutForUIExtensions} = await this.loadUIExtensions(\n      configuration.extensionDirectories,\n    )\n    const {themeExtensions, usedCustomLayout: usedCustomLayoutForThemeExtensions} = await this.loadThemeExtensions(\n      configuration.extensionDirectories,\n    )\n    const packageJSONPath = joinPath(this.appDirectory, 'package.json')\n    const name = await loadAppName(this.appDirectory)\n    const nodeDependencies = await getDependencies(packageJSONPath)\n    const packageManager = await getPackageManager(this.appDirectory)\n    const {webs, usedCustomLayout: usedCustomLayoutForWeb} = await this.loadWebs(configuration.webDirectories)\n    const usesWorkspaces = await appUsesWorkspaces(this.appDirectory)\n\n    const appClass = new App(\n      name,\n      'SHOPIFY_API_KEY',\n      this.appDirectory,\n      packageManager,\n      configuration,\n      configurationPath,\n      nodeDependencies,\n      webs,\n      uiExtensions,\n      themeExtensions,\n      functions,\n      usesWorkspaces,\n      dotenv,\n    )\n\n    if (!this.errors.isEmpty()) appClass.errors = this.errors\n\n    await logMetadataForLoadedApp(appClass, {\n      usedCustomLayoutForWeb,\n      usedCustomLayoutForUIExtensions,\n      usedCustomLayoutForFunctionExtensions,\n      usedCustomLayoutForThemeExtensions,\n    })\n\n    return appClass\n  }\n\n  async loadDotEnv(): Promise<DotEnvFile | undefined> {\n    let dotEnvFile: DotEnvFile | undefined\n    const dotEnvPath = joinPath(this.appDirectory, dotEnvFileNames.production)\n    if (await fileExists(dotEnvPath)) {\n      dotEnvFile = await readAndParseDotEnv(dotEnvPath)\n    }\n    return dotEnvFile\n  }\n\n  async findAppDirectory() {\n    if (!(await fileExists(this.directory))) {\n      throw new AbortError(outputContent`Couldn't find directory ${outputToken.path(this.directory)}`)\n    }\n    return dirname(await this.getConfigurationPath())\n  }\n\n  async getConfigurationPath() {\n    if (this.configurationPath) return this.configurationPath\n\n    const configurationPath = await findPathUp(configurationFileNames.app, {\n      cwd: this.directory,\n      type: 'file',\n    })\n    if (!configurationPath) {\n      throw new AbortError(\n        outputContent`Couldn't find the configuration file for ${outputToken.path(\n          this.directory,\n        )}, are you in an app directory?`,\n      )\n    }\n\n    this.configurationPath = configurationPath\n    return configurationPath\n  }\n\n  async loadWebs(webDirectories?: string[]): Promise<{webs: Web[]; usedCustomLayout: boolean}> {\n    const defaultWebDirectory = '**'\n    const webConfigGlobs = [...(webDirectories ?? [defaultWebDirectory])].map((webGlob) => {\n      return joinPath(this.appDirectory, webGlob, configurationFileNames.web)\n    })\n    const webTomlPaths = await glob(webConfigGlobs)\n\n    const webs = await Promise.all(webTomlPaths.map((path) => this.loadWeb(path)))\n\n    const webTomlsInStandardLocation = await glob(joinPath(this.appDirectory, `web/**/${configurationFileNames.web}`))\n    const usedCustomLayout = webDirectories !== undefined || webTomlsInStandardLocation.length !== webTomlPaths.length\n\n    return {webs, usedCustomLayout}\n  }\n\n  async loadWeb(WebConfigurationFile: string): Promise<Web> {\n    return {\n      directory: dirname(WebConfigurationFile),\n      configuration: await this.parseConfigurationFile(WebConfigurationSchema, WebConfigurationFile),\n      framework: await resolveFramework(dirname(WebConfigurationFile)),\n    }\n  }\n\n  async loadConfigurationFile(\n    filepath: string,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    decode: (input: any) => any = decodeToml,\n  ): Promise<unknown> {\n    if (!(await fileExists(filepath))) {\n      return this.abortOrReport(\n        outputContent`Couldn't find the configuration file at ${outputToken.path(filepath)}`,\n        '',\n        filepath,\n      )\n    }\n    const configurationContent = await readFile(filepath)\n    let configuration: object\n    try {\n      configuration = decode(configurationContent)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    } catch (err: any) {\n      // TOML errors have line, pos and col properties\n      if (err.line && err.pos && err.col) {\n        return this.abortOrReport(\n          outputContent`Fix the following error in ${outputToken.path(filepath)}:\\n${err.message}`,\n          null,\n          filepath,\n        )\n      } else {\n        throw err\n      }\n    }\n    // Convert snake_case keys to camelCase before returning\n    return {\n      ...Object.fromEntries(Object.entries(configuration).map((kv) => [camelize(kv[0]), kv[1]])),\n    }\n  }\n\n  async parseConfigurationFile<TSchema extends zod.ZodType>(\n    schema: TSchema,\n    filepath: string,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    decode: (input: any) => any = decodeToml,\n  ): Promise<zod.TypeOf<TSchema>> {\n    const fallbackOutput = {} as zod.TypeOf<TSchema>\n\n    const configurationObject = await this.loadConfigurationFile(filepath, decode)\n    if (!configurationObject) return fallbackOutput\n\n    const parseResult = schema.safeParse(configurationObject)\n\n    if (!parseResult.success) {\n      const formattedError = JSON.stringify(parseResult.error.issues, null, 2)\n      return this.abortOrReport(\n        outputContent`Fix a schema error in ${outputToken.path(filepath)}:\\n${formattedError}`,\n        fallbackOutput,\n        filepath,\n      )\n    }\n    return parseResult.data\n  }\n\n  async loadUIExtensions(\n    extensionDirectories?: string[],\n  ): Promise<{uiExtensions: UIExtension[]; usedCustomLayout: boolean}> {\n    const extensionConfigPaths = [...(extensionDirectories ?? [defaultExtensionDirectory])].map((extensionPath) => {\n      return joinPath(this.appDirectory, extensionPath, `${configurationFileNames.extension.ui}`)\n    })\n    const configPaths = await glob(extensionConfigPaths)\n\n    const extensions = configPaths.map(async (configurationPath) => {\n      const directory = dirname(configurationPath)\n      const fileContent = await readFile(configurationPath)\n      const obj = decodeToml(fileContent)\n      const {type} = TypeSchema.parse(obj)\n      const specification = this.findSpecificationForType(type) as UIExtensionSpec | undefined\n\n      if (!specification) {\n        const isShopifolk = await isShopify()\n        const shopifolkMessage = '\\nYou might need to enable some beta flags on your Organization or App'\n        this.abortOrReport(\n          outputContent`Unknown extension type ${outputToken.yellow(type)} in ${outputToken.path(configurationPath)}. ${\n            isShopifolk ? shopifolkMessage : ''\n          }`,\n          undefined,\n          configurationPath,\n        )\n        return undefined\n      }\n\n      const configuration = await this.parseConfigurationFile(specification.schema, configurationPath)\n\n      let entryPath\n      if (specification.singleEntryPath) {\n        entryPath = (\n          await Promise.all(\n            ['index']\n              .flatMap((name) => [`${name}.js`, `${name}.jsx`, `${name}.ts`, `${name}.tsx`])\n              .flatMap((fileName) => [`src/${fileName}`, `${fileName}`])\n              .map((relativePath) => joinPath(directory, relativePath))\n              .map(async (sourcePath) => ((await fileExists(sourcePath)) ? sourcePath : undefined)),\n          )\n        ).find((sourcePath) => sourcePath !== undefined)\n        if (!entryPath) {\n          this.abortOrReport(\n            outputContent`Couldn't find an index.{js,jsx,ts,tsx} file in the directories ${outputToken.path(\n              directory,\n            )} or ${outputToken.path(joinPath(directory, 'src'))}`,\n            undefined,\n            directory,\n          )\n        }\n      }\n\n      const extensionInstance = new UIExtensionInstance({\n        configuration,\n        configurationPath,\n        entryPath: entryPath ?? '',\n        directory,\n        specification,\n      })\n\n      if (configuration.type) {\n        const validateResult = await extensionInstance.validate()\n        if (validateResult.isErr()) {\n          this.abortOrReport(outputContent`\\n${validateResult.error}`, undefined, configurationPath)\n        }\n      }\n      return extensionInstance\n    })\n\n    const uiExtensions = getArrayRejectingUndefined(await Promise.all(extensions))\n    return {uiExtensions, usedCustomLayout: extensionDirectories !== undefined}\n  }\n\n  async loadFunctions(\n    extensionDirectories?: string[],\n  ): Promise<{functions: FunctionExtension[]; usedCustomLayout: boolean}> {\n    const functionConfigPaths = [...(extensionDirectories ?? [defaultExtensionDirectory])].map((extensionPath) => {\n      return joinPath(this.appDirectory, extensionPath, `${configurationFileNames.extension.function}`)\n    })\n    const configPaths = await glob(functionConfigPaths)\n\n    const allFunctions = configPaths.map(async (configurationPath) => {\n      const directory = dirname(configurationPath)\n      const configuration = await this.parseConfigurationFile(BaseFunctionConfigurationSchema, configurationPath)\n\n      const entryPath = (\n        await Promise.all(\n          ['src/index.js', 'src/index.ts', 'src/main.rs']\n            .map((relativePath) => joinPath(directory, relativePath))\n            .map(async (sourcePath) => ((await fileExists(sourcePath)) ? sourcePath : undefined)),\n        )\n      ).find((sourcePath) => sourcePath !== undefined)\n\n      return new FunctionInstance({\n        configuration,\n        configurationPath,\n        entryPath,\n        directory,\n      })\n    })\n    const functions = getArrayRejectingUndefined(await Promise.all(allFunctions))\n    return {functions, usedCustomLayout: extensionDirectories !== undefined}\n  }\n\n  async loadThemeExtensions(\n    extensionDirectories?: string[],\n  ): Promise<{themeExtensions: ThemeExtension[]; usedCustomLayout: boolean}> {\n    const themeConfigPaths = [...(extensionDirectories ?? [defaultExtensionDirectory])].map((extensionPath) => {\n      return joinPath(this.appDirectory, extensionPath, `${configurationFileNames.extension.theme}`)\n    })\n    const configPaths = await glob(themeConfigPaths)\n\n    const extensions = configPaths.map(async (configurationPath) => {\n      const directory = dirname(configurationPath)\n      const configuration = await this.parseConfigurationFile(ThemeExtensionSchema, configurationPath)\n      const specification = this.findSpecificationForType('theme') as ThemeExtensionSpec | undefined\n\n      if (!specification) {\n        this.abortOrReport(\n          outputContent`Unknown theme type ${outputToken.yellow('theme')} in ${outputToken.path(configurationPath)}`,\n          undefined,\n          configurationPath,\n        )\n        return undefined\n      }\n\n      return new ThemeExtensionInstance({\n        configuration,\n        configurationPath,\n        directory,\n        specification,\n        outputBundlePath: directory,\n      })\n    })\n\n    const themeExtensions = getArrayRejectingUndefined(await Promise.all(extensions))\n\n    return {themeExtensions, usedCustomLayout: extensionDirectories !== undefined}\n  }\n\n  abortOrReport<T>(errorMessage: OutputMessage, fallback: T, configurationPath: string): T {\n    if (this.mode === 'strict') {\n      throw new AbortError(errorMessage)\n    } else {\n      this.errors.addError(configurationPath, errorMessage)\n      return fallback\n    }\n  }\n}\n\nexport async function loadAppName(appDirectory: string): Promise<string> {\n  const packageJSONPath = joinPath(appDirectory, 'package.json')\n  return (await getPackageName(packageJSONPath)) ?? basename(appDirectory)\n}\n\nasync function getProjectType(webs: Web[]): Promise<'node' | 'php' | 'ruby' | 'frontend' | undefined> {\n  const backendWebs = webs.filter((web) => web.configuration.type === WebType.Backend)\n  const frontendWebs = webs.filter((web) => web.configuration.type === WebType.Frontend)\n  if (backendWebs.length > 1) {\n    outputDebug('Unable to decide project type as multiple web backends')\n    return\n  } else if (backendWebs.length === 0 && frontendWebs.length > 0) {\n    return 'frontend'\n  } else if (backendWebs.length === 0) {\n    outputDebug('Unable to decide project type as no web backend')\n    return\n  }\n  const {directory} = backendWebs[0]!\n\n  const nodeConfigFile = joinPath(directory, 'package.json')\n  const rubyConfigFile = joinPath(directory, 'Gemfile')\n  const phpConfigFile = joinPath(directory, 'composer.json')\n\n  if (await fileExists(nodeConfigFile)) {\n    return 'node'\n  } else if (await fileExists(rubyConfigFile)) {\n    return 'ruby'\n  } else if (await fileExists(phpConfigFile)) {\n    return 'php'\n  }\n  return undefined\n}\n\nasync function logMetadataForLoadedApp(\n  app: App,\n  loadingStrategy: {\n    usedCustomLayoutForWeb: boolean\n    usedCustomLayoutForUIExtensions: boolean\n    usedCustomLayoutForFunctionExtensions: boolean\n    usedCustomLayoutForThemeExtensions: boolean\n  },\n) {\n  await metadata.addPublicMetadata(async () => {\n    const projectType = await getProjectType(app.webs)\n\n    const extensionFunctionCount = app.extensions.function.length\n    const extensionUICount = app.extensions.ui.length\n    const extensionThemeCount = app.extensions.theme.length\n\n    const extensionTotalCount = extensionFunctionCount + extensionUICount + extensionThemeCount\n\n    const webBackendCount = app.webs.filter((web) => web.configuration.type === WebType.Backend).length\n    const webBackendFramework =\n      webBackendCount === 1\n        ? app.webs.filter((web) => web.configuration.type === WebType.Backend)[0]?.framework\n        : undefined\n    const webFrontendCount = app.webs.filter((web) => web.configuration.type === WebType.Frontend).length\n\n    const allExtensions: Extension[] = [...app.extensions.function, ...app.extensions.theme, ...app.extensions.ui]\n    const extensionsBreakdownMapping: {[key: string]: number} = {}\n    for (const extension of allExtensions) {\n      if (extensionsBreakdownMapping[extension.type] === undefined) {\n        extensionsBreakdownMapping[extension.type] = 1\n      } else {\n        extensionsBreakdownMapping[extension.type]++\n      }\n    }\n\n    return {\n      project_type: projectType,\n      app_extensions_any: extensionTotalCount > 0,\n      app_extensions_breakdown: JSON.stringify(extensionsBreakdownMapping),\n      app_extensions_count: extensionTotalCount,\n      app_extensions_custom_layout:\n        loadingStrategy.usedCustomLayoutForFunctionExtensions ||\n        loadingStrategy.usedCustomLayoutForThemeExtensions ||\n        loadingStrategy.usedCustomLayoutForUIExtensions,\n      app_extensions_function_any: extensionFunctionCount > 0,\n      app_extensions_function_count: extensionFunctionCount,\n      app_extensions_function_custom_layout: loadingStrategy.usedCustomLayoutForFunctionExtensions,\n      app_extensions_theme_any: extensionThemeCount > 0,\n      app_extensions_theme_count: extensionThemeCount,\n      app_extensions_theme_custom_layout: loadingStrategy.usedCustomLayoutForThemeExtensions,\n      app_extensions_ui_any: extensionUICount > 0,\n      app_extensions_ui_count: extensionUICount,\n      app_extensions_ui_custom_layout: loadingStrategy.usedCustomLayoutForUIExtensions,\n      app_name_hash: hashString(app.name),\n      app_path_hash: hashString(app.directory),\n      app_scopes: JSON.stringify(\n        app.configuration.scopes\n          .split(',')\n          .map((scope) => scope.trim())\n          .sort(),\n      ),\n      app_web_backend_any: webBackendCount > 0,\n      app_web_backend_count: webBackendCount,\n      app_web_custom_layout: loadingStrategy.usedCustomLayoutForWeb,\n      app_web_framework: webBackendFramework,\n      app_web_frontend_any: webFrontendCount > 0,\n      app_web_frontend_count: webFrontendCount,\n      env_package_manager_workspaces: app.usesWorkspaces,\n    }\n  })\n\n  await metadata.addSensitiveMetadata(async () => {\n    return {\n      app_name: app.name,\n    }\n  })\n}\n"]}