{"version":3,"file":"ui.js","sourceRoot":"","sources":["../../../src/private/node/ui.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAC,UAAU,EAAE,UAAU,EAAoB,sBAAsB,EAAC,MAAM,6BAA6B,CAAA;AAC5G,OAAO,EAAC,UAAU,EAAC,MAAM,oCAAoC,CAAA;AAE7D,OAAO,EAAM,MAAM,IAAI,SAAS,EAAgB,MAAM,KAAK,CAAA;AAC3D,OAAO,QAAQ,MAAM,WAAW,CAAA;AAChC,OAAO,EAAC,YAAY,EAAC,MAAM,QAAQ,CAAA;AAQnC,MAAM,UAAU,UAAU,CACxB,OAAoB,EACpB,EAAC,QAAQ,GAAG,MAAM,EAAE,MAAM,GAAG,UAAU,EAAE,aAAa,EAAoB;IAE1E,MAAM,EAAC,MAAM,EAAE,OAAO,EAAC,GAAG,YAAY,CAAC,OAAO,EAAE,aAAa,CAAC,CAAA;IAE9D,IAAI,MAAM,EAAE;QACV,IAAI,UAAU,EAAE;YAAE,UAAU,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAA;QAC9C,sBAAsB,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC,CAAA;KACjD;IAED,OAAO,EAAE,CAAA;IAET,OAAO,MAAM,CAAA;AACf,CAAC;AAED,MAAM,UAAU,MAAM,CAAC,OAAoB,EAAE,OAAuB;IAClE,MAAM,EAAC,aAAa,EAAC,GAAG,SAAS,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;IACnD,OAAO,aAAa,EAAE,CAAA;AACxB,CAAC;AAOD,MAAM,OAAO,YAAa,SAAQ,YAAY;IAM5C,YAAY,OAA0C;QACpD,KAAK,EAAE,CAAA;QAJA,WAAM,GAAa,EAAE,CAAA;QAS9B,UAAK,GAAG,CAAC,KAAa,EAAE,EAAE;YACxB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;YACvB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAA;QACzB,CAAC,CAAA;QAED,cAAS,GAAG,GAAG,EAAE;YACf,OAAO,IAAI,CAAC,UAAU,CAAA;QACxB,CAAC,CAAA;QAXC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,IAAI,EAAE,CAAA;QACpC,IAAI,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,IAAI,EAAE,CAAA;IAChC,CAAC;CAUF;AAED,MAAM,CAAC,MAAM,YAAY,GAAG,CAAC,OAAqB,EAAE,aAA6B,EAAY,EAAE;IAC7F,8DAA8D;IAC9D,MAAM,MAAM,GAAI,aAAa,EAAE,MAAc,IAAI,IAAI,YAAY,CAAC,EAAC,OAAO,EAAE,OAAO,CAAC,MAAM,CAAC,OAAO,EAAC,CAAC,CAAA;IACpG,8DAA8D;IAC9D,MAAM,MAAM,GAAI,aAAa,EAAE,MAAc,IAAI,IAAI,YAAY,CAAC,EAAC,OAAO,EAAE,OAAO,CAAC,MAAM,CAAC,OAAO,EAAC,CAAC,CAAA;IAEpG,MAAM,QAAQ,GAAG,SAAS,CAAC,OAAO,EAAE;QAClC,MAAM;QACN,MAAM;QACN,KAAK,EAAE,IAAI;QACX,WAAW,EAAE,KAAK;QAClB,YAAY,EAAE,KAAK;KACpB,CAAC,CAAA;IAEF,OAAO;QACL,MAAM,EAAE,MAAM,CAAC,SAAS,EAAE;QAC1B,OAAO,EAAE,QAAQ,CAAC,OAAO;KAC1B,CAAA;AACH,CAAC,CAAA;AAED,MAAM,UAAU,WAAW,CAAC,KAAa,EAAE,GAAQ;IACjD,IAAI,KAAK,KAAK,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE;QAC7B,gEAAgE;QAChE,QAAQ,CAAC,OAAO,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAA;KAChC;AACH,CAAC","sourcesContent":["import {collectLog, consoleLog, Logger, LogLevel, outputWhereAppropriate} from '../../public/node/output.js'\nimport {isUnitTest} from '../../public/node/context/local.js'\nimport {ReactElement} from 'react'\nimport {Key, render as inkRender, RenderOptions} from 'ink'\nimport treeKill from 'tree-kill'\nimport {EventEmitter} from 'events'\n\ninterface RenderOnceOptions {\n  logLevel?: LogLevel\n  logger?: Logger\n  renderOptions?: RenderOptions\n}\n\nexport function renderOnce(\n  element: JSX.Element,\n  {logLevel = 'info', logger = consoleLog, renderOptions}: RenderOnceOptions,\n) {\n  const {output, unmount} = renderString(element, renderOptions)\n\n  if (output) {\n    if (isUnitTest()) collectLog(logLevel, output)\n    outputWhereAppropriate(logLevel, logger, output)\n  }\n\n  unmount()\n\n  return output\n}\n\nexport function render(element: JSX.Element, options?: RenderOptions) {\n  const {waitUntilExit} = inkRender(element, options)\n  return waitUntilExit()\n}\n\ninterface Instance {\n  output: string | undefined\n  unmount: () => void\n}\n\nexport class OutputStream extends EventEmitter {\n  columns: number\n  rows: number\n  readonly frames: string[] = []\n  private _lastFrame?: string\n\n  constructor(options: {columns?: number; rows?: number}) {\n    super()\n    this.columns = options.columns ?? 80\n    this.rows = options.rows ?? 80\n  }\n\n  write = (frame: string) => {\n    this.frames.push(frame)\n    this._lastFrame = frame\n  }\n\n  lastFrame = () => {\n    return this._lastFrame\n  }\n}\n\nexport const renderString = (element: ReactElement, renderOptions?: RenderOptions): Instance => {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const stdout = (renderOptions?.stdout as any) ?? new OutputStream({columns: process.stdout.columns})\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const stderr = (renderOptions?.stderr as any) ?? new OutputStream({columns: process.stderr.columns})\n\n  const instance = inkRender(element, {\n    stdout,\n    stderr,\n    debug: true,\n    exitOnCtrlC: false,\n    patchConsole: false,\n  })\n\n  return {\n    output: stdout.lastFrame(),\n    unmount: instance.unmount,\n  }\n}\n\nexport function handleCtrlC(input: string, key: Key) {\n  if (input === 'c' && key.ctrl) {\n    // Exceptions thrown in hooks aren't caught by our errorHandler.\n    treeKill(process.pid, 'SIGINT')\n  }\n}\n"]}